# Rust AutoGen-Core ä»£ç ä¿®å¤è®¡åˆ’

## ğŸ“‹ è®¡åˆ’æ¦‚è¿°

åŸºäºåŠŸèƒ½å·®å¼‚åˆ†ææŠ¥å‘Šï¼Œåˆ¶å®šåˆ†é˜¶æ®µçš„ä»£ç ä¿®å¤è®¡åˆ’ï¼Œä¼˜å…ˆè§£å†³ä¸¥é‡ç¼ºå¤±çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œé€æ­¥å®Œå–„æ•´ä¸ªç³»ç»Ÿã€‚

## ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒè¿è¡Œæ—¶ä¿®å¤ (é«˜ä¼˜å…ˆçº§)

### ä»»åŠ¡ 1.1: ä¿®å¤è¿è¡Œæ—¶"æœªå®ç°"åŠŸèƒ½
**æ–‡ä»¶**: `rust/autogen-core/src/single_threaded_agent_runtime.rs`
**é¢„ä¼°å·¥ä½œé‡**: 3-5 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **å®ç° Intervention Handler å¤„ç†**
   - æ·»åŠ æ¶ˆæ¯æ‹¦æˆªé€»è¾‘
   - å®ç°å¤„ç†é“¾æ¨¡å¼
   - æ”¯æŒæ¶ˆæ¯ä¿®æ”¹å’Œä¸¢å¼ƒ

2. **å®Œå–„è®¢é˜…ç®¡ç†ç³»ç»Ÿ**
   - å®ç° `add_subscription` çš„å®é™…é€»è¾‘
   - å®ç° `remove_subscription` çš„å®é™…é€»è¾‘
   - æ·»åŠ è®¢é˜…å­˜å‚¨å’ŒæŸ¥è¯¢æœºåˆ¶

3. **å®ç°çŠ¶æ€æŒä¹…åŒ–**
   - å®Œå–„ `save_state` æ–¹æ³•
   - æ·»åŠ  `load_state` æ–¹æ³•
   - å®ç° Agent çŠ¶æ€åºåˆ—åŒ–

4. **è§£å†³å¼‚æ­¥ç»‘å®šé—®é¢˜**
   - é‡æ„ Agent ç»‘å®šé€»è¾‘
   - è§£å†³ Send trait çº¦æŸé—®é¢˜
   - ç¡®ä¿çº¿ç¨‹å®‰å…¨

### ä»»åŠ¡ 1.2: å®Œå–„æ¶ˆæ¯å¤„ç†æœºåˆ¶
**æ–‡ä»¶**: `rust/autogen-core/src/single_threaded_agent_runtime.rs`, `rust/autogen-core/src/queue.rs`
**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **æ¶ˆæ¯è·¯ç”±ä¼˜åŒ–**
   - å®ç°æ™ºèƒ½æ¶ˆæ¯åˆ†å‘
   - æ·»åŠ è·¯ç”±è§„åˆ™å¼•æ“
   - æ”¯æŒæ¶ˆæ¯ä¼˜å…ˆçº§

2. **é”™è¯¯å¤„ç†å¢å¼º**
   - æ·»åŠ é‡è¯•æœºåˆ¶
   - å®ç°é”™è¯¯æ¢å¤ç­–ç•¥
   - å®Œå–„å¼‚å¸¸ä¼ æ’­

## ğŸ¯ ç¬¬äºŒé˜¶æ®µï¼šæ¨¡å‹å®¢æˆ·ç«¯ç³»ç»Ÿ (é«˜ä¼˜å…ˆçº§)

### ä»»åŠ¡ 2.1: æ‰©å±•æ¨¡å‹ç±»å‹ç³»ç»Ÿ
**æ–‡ä»¶**: `rust/autogen-core/src/models/types.rs`
**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **æ·»åŠ ç¼ºå¤±çš„å“åº”ç±»å‹**
   ```rust
   // éœ€è¦æ·»åŠ çš„ç±»å‹
   pub struct RequestUsage { /* ... */ }
   pub enum FinishReasons { /* ... */ }
   pub struct CreateResult { /* ... */ }
   pub struct TopLogprob { /* ... */ }
   pub struct ChatCompletionTokenLogprob { /* ... */ }
   ```

2. **å¢å¼ºæ¶ˆæ¯ç±»å‹**
   - æ”¯æŒæ›´å¤æ‚çš„å†…å®¹ç±»å‹
   - æ·»åŠ å…ƒæ•°æ®æ”¯æŒ
   - å®ç°æ¶ˆæ¯éªŒè¯

### ä»»åŠ¡ 2.2: å®ç°æ¨¡å‹èƒ½åŠ›ç³»ç»Ÿ
**æ–‡ä»¶**: `rust/autogen-core/src/models/model_client.rs` (æ–°å»ºç›¸å…³æ–‡ä»¶)
**é¢„ä¼°å·¥ä½œé‡**: 3-4 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **åˆ›å»ºæ¨¡å‹ä¿¡æ¯ç³»ç»Ÿ**
   ```rust
   // éœ€è¦å®ç°çš„ç»“æ„
   pub struct ModelCapabilities { /* ... */ }
   pub enum ModelFamily { /* ... */ }
   pub struct ModelInfo { /* ... */ }
   pub fn validate_model_info(info: &ModelInfo) -> Result<(), Error>;
   ```

2. **æ‰©å±• ChatCompletionClient**
   - æ·»åŠ  `create` æ–¹æ³•
   - æ”¯æŒæµå¼å¤„ç†
   - å®ç°å·¥å…·è°ƒç”¨
   - æ·»åŠ ç»“æ„åŒ–è¾“å‡ºæ”¯æŒ

## ğŸ¯ ç¬¬ä¸‰é˜¶æ®µï¼šè®¢é˜…å’Œæ¶ˆæ¯ç³»ç»Ÿ (ä¸­ä¼˜å…ˆçº§)

### ä»»åŠ¡ 3.1: å®Œå–„è®¢é˜…ç®¡ç†å™¨
**æ–‡ä»¶**: `rust/autogen-core/src/subscription_manager.rs`
**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **å®ç°è®¢é˜…å­˜å‚¨**
   - æ·»åŠ æŒä¹…åŒ–è®¢é˜…å­˜å‚¨
   - å®ç°è®¢é˜…æŸ¥è¯¢ä¼˜åŒ–
   - æ”¯æŒåŠ¨æ€è®¢é˜…æ›´æ–°

2. **ä¼˜åŒ–åŒ¹é…ç®—æ³•**
   - å®ç°é«˜æ•ˆçš„ä¸»é¢˜åŒ¹é…
   - æ”¯æŒé€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼
   - æ·»åŠ è®¢é˜…ä¼˜å…ˆçº§

### ä»»åŠ¡ 3.2: å¢å¼ºæ¶ˆæ¯ä¸Šä¸‹æ–‡
**æ–‡ä»¶**: `rust/autogen-core/src/message_context.rs`, `rust/autogen-core/src/message_handler_context.rs`
**é¢„ä¼°å·¥ä½œé‡**: 1-2 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **æ‰©å±•ä¸Šä¸‹æ–‡ä¿¡æ¯**
   - æ·»åŠ æ›´å¤šå…ƒæ•°æ®
   - æ”¯æŒä¸Šä¸‹æ–‡ä¼ æ’­
   - å®ç°ä¸Šä¸‹æ–‡éªŒè¯

## ğŸ¯ ç¬¬å››é˜¶æ®µï¼šç»„ä»¶é…ç½®ç³»ç»Ÿ (ä¸­ä¼˜å…ˆçº§)

### ä»»åŠ¡ 4.1: å®ç°ç»„ä»¶é…ç½®ç®¡ç†
**æ–‡ä»¶**: `rust/autogen-core/src/component_config.rs`
**é¢„ä¼°å·¥ä½œé‡**: 3-4 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **åˆ›å»ºé…ç½®åŠ è½½å™¨**
   ```rust
   // éœ€è¦å®ç°çš„åŠŸèƒ½
   pub struct ComponentLoader { /* ... */ }
   pub trait ComponentFromConfig { /* ... */ }
   pub trait ComponentToConfig { /* ... */ }
   ```

2. **æ·»åŠ ç»„ä»¶å·¥å…·å‡½æ•°**
   ```rust
   pub fn is_component_class<T>() -> bool;
   pub fn is_component_instance<T>(obj: &T) -> bool;
   ```

3. **å®ç°ç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - ç»„ä»¶åˆå§‹åŒ–
   - é…ç½®éªŒè¯
   - ä¾èµ–æ³¨å…¥

## ğŸ¯ ç¬¬äº”é˜¶æ®µï¼šå†…å­˜å’Œä»£ç æ‰§è¡Œ (ä¸­ä¼˜å…ˆçº§)

### ä»»åŠ¡ 5.1: å®ç°å†…å­˜ç®¡ç†ç³»ç»Ÿ
**æ–‡ä»¶**: `rust/autogen-core/src/memory/list_memory.rs` (æ–°å»ºå®ç°)
**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **å®ç° ListMemory**
   - åŸºç¡€å†…å­˜å­˜å‚¨
   - æŸ¥è¯¢å’Œç´¢å¼•
   - ä¸æ¨¡å‹ä¸Šä¸‹æ–‡é›†æˆ

### ä»»åŠ¡ 5.2: å®Œå–„ä»£ç æ‰§è¡Œå™¨
**æ–‡ä»¶**: `rust/autogen-core/src/code_executor/`
**é¢„ä¼°å·¥ä½œé‡**: 4-5 å¤©

**å…·ä½“ä»»åŠ¡**:
1. **å®ç°å®‰å…¨æ‰§è¡Œç¯å¢ƒ**
   - æ²™ç®±éš”ç¦»
   - èµ„æºé™åˆ¶
   - ä¾èµ–ç®¡ç†

## ğŸ¯ ç¬¬å…­é˜¶æ®µï¼šé¥æµ‹å’Œå·¥å…·ç³»ç»Ÿ (ä½ä¼˜å…ˆçº§)

### ä»»åŠ¡ 6.1: å®Œå–„é¥æµ‹é›†æˆ
**æ–‡ä»¶**: `rust/autogen-core/src/telemetry/`
**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

### ä»»åŠ¡ 6.2: å¢å¼ºå·¥å…·ç³»ç»Ÿ
**æ–‡ä»¶**: `rust/autogen-core/src/tools/`
**é¢„ä¼°å·¥ä½œé‡**: 2-3 å¤©

## ğŸ“… æ—¶é—´è®¡åˆ’

| é˜¶æ®µ | é¢„ä¼°æ—¶é—´ | å…³é”®é‡Œç¨‹ç¢‘ |
|------|----------|------------|
| ç¬¬ä¸€é˜¶æ®µ | 1-2 å‘¨ | è¿è¡Œæ—¶æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ |
| ç¬¬äºŒé˜¶æ®µ | 1-1.5 å‘¨ | æ¨¡å‹å®¢æˆ·ç«¯åŸºæœ¬å¯ç”¨ |
| ç¬¬ä¸‰é˜¶æ®µ | 1 å‘¨ | æ¶ˆæ¯ç³»ç»Ÿå®Œå–„ |
| ç¬¬å››é˜¶æ®µ | 1 å‘¨ | ç»„ä»¶é…ç½®å¯ç”¨ |
| ç¬¬äº”é˜¶æ®µ | 1.5 å‘¨ | å†…å­˜å’Œæ‰§è¡Œå™¨å¯ç”¨ |
| ç¬¬å…­é˜¶æ®µ | 1 å‘¨ | ç³»ç»ŸåŠŸèƒ½å®Œæ•´ |

**æ€»é¢„ä¼°æ—¶é—´**: 6-8 å‘¨

## ğŸ§ª æµ‹è¯•ç­–ç•¥

1. **å•å…ƒæµ‹è¯•**: æ¯ä¸ªä¿®å¤çš„æ¨¡å—éƒ½è¦æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•
2. **é›†æˆæµ‹è¯•**: å…³é”®åŠŸèƒ½çš„ç«¯åˆ°ç«¯æµ‹è¯•
3. **æ€§èƒ½æµ‹è¯•**: ä¸ Python ç‰ˆæœ¬çš„æ€§èƒ½å¯¹æ¯”
4. **å…¼å®¹æ€§æµ‹è¯•**: ç¡®ä¿ API å…¼å®¹æ€§

## ğŸ“‹ éªŒæ”¶æ ‡å‡†

1. **åŠŸèƒ½å®Œæ•´æ€§**: æ‰€æœ‰"æœªå®ç°"æ ‡è®°è¢«ç§»é™¤
2. **æµ‹è¯•è¦†ç›–ç‡**: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–ç‡ > 80%
3. **æ–‡æ¡£å®Œæ•´æ€§**: æ‰€æœ‰å…¬å…± API éƒ½æœ‰æ–‡æ¡£
4. **æ€§èƒ½åŸºå‡†**: å…³é”®æ“ä½œæ€§èƒ½ä¸ä½äº Python ç‰ˆæœ¬

## ğŸ› ï¸ å®æ–½æŒ‡å¯¼

### å¼€å‘ç¯å¢ƒå‡†å¤‡
1. **ä¾èµ–æ£€æŸ¥**: ç¡®ä¿ `Cargo.toml` ä¸­çš„ä¾èµ–ç‰ˆæœ¬å…¼å®¹
2. **å¼€å‘å·¥å…·**: å®‰è£… `cargo-watch`, `cargo-nextest` ç­‰å¼€å‘å·¥å…·
3. **IDE é…ç½®**: é…ç½® rust-analyzer å’Œç›¸å…³æ’ä»¶

### ä»£ç è´¨é‡æ ‡å‡†
1. **ä»£ç é£æ ¼**: ä½¿ç”¨ `rustfmt` å’Œ `clippy`
2. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€ä½¿ç”¨ `thiserror` å’Œ `anyhow`
3. **å¼‚æ­¥ç¼–ç¨‹**: éµå¾ª Tokio æœ€ä½³å®è·µ
4. **æ–‡æ¡£**: æ‰€æœ‰å…¬å…± API å¿…é¡»æœ‰ rustdoc æ³¨é‡Š

### ç¬¬ä¸€é˜¶æ®µè¯¦ç»†å®æ–½æ­¥éª¤

#### æ­¥éª¤ 1: ä¿®å¤ Intervention Handler
```rust
// åœ¨ single_threaded_agent_runtime.rs ä¸­æ·»åŠ 
pub struct InterventionContext {
    pub message: Value,
    pub sender: Option<AgentId>,
    pub recipient: AgentId,
    pub metadata: HashMap<String, Value>,
}

pub trait InterventionHandler: Send + Sync {
    async fn handle(&self, ctx: &mut InterventionContext) -> Result<InterventionAction, Box<dyn Error>>;
}

pub enum InterventionAction {
    Continue,
    ModifyMessage(Value),
    DropMessage,
    Redirect(AgentId),
}
```

#### æ­¥éª¤ 2: å®ç°è®¢é˜…ç®¡ç†
```rust
// åœ¨ subscription_manager.rs ä¸­å®ç°
impl SubscriptionManager {
    pub fn add_subscription(&mut self, subscription: Box<dyn Subscription>) -> Result<(), Error> {
        // å®é™…çš„è®¢é˜…æ·»åŠ é€»è¾‘
        let id = subscription.id();
        self.subscriptions.insert(id, subscription);
        self.rebuild_index();
        Ok(())
    }

    pub fn remove_subscription(&mut self, id: &str) -> Result<(), Error> {
        // å®é™…çš„è®¢é˜…ç§»é™¤é€»è¾‘
        self.subscriptions.remove(id);
        self.rebuild_index();
        Ok(())
    }
}
```

### é£é™©è¯„ä¼°ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| Send/Sync çº¦æŸé—®é¢˜ | é«˜ | ä½¿ç”¨ Arc<Mutex<>> æˆ– Arc<RwLock<>> |
| å¼‚æ­¥ç”Ÿå‘½å‘¨æœŸå¤æ‚ | ä¸­ | åˆ†æ­¥é‡æ„ï¼Œå…ˆåŒæ­¥åå¼‚æ­¥ |
| å†…å­˜æ³„æ¼ | ä¸­ | ä½¿ç”¨ Weak å¼•ç”¨æ‰“ç ´å¾ªç¯ |
| æ€§èƒ½å›å½’ | ä½ | æŒç»­æ€§èƒ½æµ‹è¯• |

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

### é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹
- [ ] **M1**: è¿è¡Œæ—¶"æœªå®ç°"åŠŸèƒ½å…¨éƒ¨ä¿®å¤
- [ ] **M2**: åŸºç¡€æ¨¡å‹å®¢æˆ·ç«¯å¯ç”¨
- [ ] **M3**: æ¶ˆæ¯ç³»ç»Ÿå®Œå…¨åŠŸèƒ½
- [ ] **M4**: ç»„ä»¶é…ç½®ç³»ç»Ÿå¯ç”¨
- [ ] **M5**: å†…å­˜å’Œæ‰§è¡Œå™¨åŸºæœ¬å¯ç”¨
- [ ] **M6**: ç³»ç»ŸåŠŸèƒ½å®Œæ•´ï¼Œé€šè¿‡æ‰€æœ‰æµ‹è¯•

### æ¯æ—¥æ£€æŸ¥æ¸…å•
- [ ] ä»£ç ç¼–è¯‘æ— è­¦å‘Š
- [ ] æ–°å¢æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£æ›´æ–°å®Œæˆ
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•é€šè¿‡

## ğŸš€ å¼€å§‹å»ºè®®

**ç«‹å³å¼€å§‹**: ä»**ç¬¬ä¸€é˜¶æ®µä»»åŠ¡ 1.1**å¼€å§‹ï¼Œä¼˜å…ˆä¿®å¤è¿è¡Œæ—¶çš„"æœªå®ç°"åŠŸèƒ½
**å¹¶è¡Œå¼€å‘**: å¯ä»¥åŒæ—¶è¿›è¡Œæ¨¡å‹ç±»å‹ç³»ç»Ÿçš„è®¾è®¡å·¥ä½œ
**æŒç»­é›†æˆ**: æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡å°±è¿›è¡Œé›†æˆæµ‹è¯•

---

**è®¡åˆ’åˆ¶å®šæ—¥æœŸ**: 2025-07-12
**è®¡åˆ’ç‰ˆæœ¬**: v1.0
**ä¸‹æ¬¡è¯„ä¼°**: ç¬¬ä¸€é˜¶æ®µå®Œæˆå
